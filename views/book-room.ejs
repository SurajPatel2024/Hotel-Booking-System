<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Room - Taj Hotel</title>
     <style>
        /* General Body Styling */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f8f9fa;
}

/* Header Styling */
header {
    background-color: #343a40;
    color: white;
    padding: 15px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Container Styling */
.container {
    max-width: 600px;
    margin: 30px auto;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Headings Styling */
h1, h2, h3 {
    color: #343a40;
    margin: 10px 0;
    font-family: 'Arial', sans-serif;
    font-weight: bold;
}

/* Label Styling */
label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #495057;
}

/* Input & Select Styling */
input, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 14px;
    color: #495057;
}

input:focus, select:focus {
    border-color: #007bff;
    outline: none;
}

input:read-only {
    background-color: #e9ecef;
    color: #6c757d;
}

/* Button Styling */
button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin: 10px;
}

button:hover {
    background-color: #0056b3;
}

/* Dropdown Styling */
.dropdown select {
    appearance: none;
    background-color: #f8f9fa;
    padding: 10px;
    font-size: 14px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    cursor: pointer;
}

/* PayPal Button Container */
#paypal-button-container {
    text-align: center;
    margin-top: 15px;
}

/* Paragraphs */
p {
    margin: 10px 0;
    color: #495057;
    font-size: 14px;
}

/* Error Message Styling */
.error {
    color: red;
    font-weight: bold;
}

/* Captcha Styling */
#captchaImage {
    display: block;
    margin-bottom: 10px;
    border: 1px solid #ced4da;
    width: 100%;
    max-width: 200px;
    height: auto;
    border-radius: 4px;
}

/* Responsive Design */
@media screen and (max-width: 768px) {
    .container {
        padding: 15px;
    }

    header {
        font-size: 18px;
        padding: 10px;
    }

    button {
        font-size: 12px;
        padding: 8px 12px;
    
    }

    input, select {
        font-size: 12px;
    }
}

     </style>

    <!-- Include PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=<%= process.env.PAYPAL_CLIENT_ID %>&currency=USD"></script>

</head>
<body>

 

<div class="container">
    <h2>Room Details</h2>
    <p><strong>Room Number:</strong> <%= room.roomNumber %></p>
    <p><strong>Type:</strong> <%= room.type %></p>
    <p><strong>Price:</strong> Rs. <%= room.price %></p>
    <p><strong>Description:</strong> <%= room.description %></p>
 
    <% if (room.status === 'Available') { %>
        <h3>Are you sure you want to book this room?</h3>
        <form action="/book-room/<%= room._id %>" method="POST" id="booking-form">
            <label for="userName">Name:</label>
            <input type="text" id="userName" name="userName" value="<%= user.username %>" readonly><br><br>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="<%= user.email %>" readonly><br><br>

            <label for="userContact">Contact:</label>
            <input type="text" id="userContact" name="userContact" pattern="^[789]\d{9}$" title="Phone number must be a 10-digit Indian number starting with 7, 8, or 9" required><br><br>

            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" name="startDate" required><br><br>

            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" name="endDate" required><br><br>

            <!-- Payment method form -->
            <div class="dropdown">
                <label for="paymentMethod">Payment Method:</label>
                <select id="paymentMethod" name="paymentMethod" required onchange="togglePaymentMethod(this.value)">
                    <option value="" disabled selected>Select Payment Method</option>
                    <option value="Cash">Cash</option>
                    <option value="Online">Online</option>
                </select>
            </div>

            <!-- PayPal Button Container -->
            <div id="paypal-button-container" style="display:none;"></div>
            <label for="captcha">Enter the text shown below:</label>
            <img id="captchaImage" src="/captcha" alt="CAPTCHA" style="display: block; margin-bottom: 10px; border: 1px solid #ced4da;">
            <input type="text" id="captcha" name="captcha" required>
            <button type="button" onclick="reloadCaptcha()">Reload CAPTCHA</button>
            <button type="submit" id="book-button" style="display:none;">Book Now</button>
        </form>
    <% } else { %>
        <p>This room is already booked.</p>
    <% } %>
 
</div>
<script>
    function reloadCaptcha() {
    document.getElementById('captchaImage').src = '/captcha?' + Date.now(); // Force refresh by appending a timestamp
}

</script>
<script>
    // Prevent selecting past or current dates
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('startDate').setAttribute('min', today);
    document.getElementById('endDate').setAttribute('min', today);

    let paypalInitialized = false; // Ensure PayPal button is initialized only once

    function togglePaymentMethod(method) {
        const paypalButtonContainer = document.getElementById('paypal-button-container');
        const bookButton = document.getElementById('book-button');

        if (method === 'Online') {
            paypalButtonContainer.style.display = 'block';  // Show PayPal button
            bookButton.style.display = 'none';  // Hide default 'Book Now' button

            if (!paypalInitialized) {
                paypalInitialized = true; // Mark as initialized

                paypal.Buttons({
                    createOrder: function(data, actions) {
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    currency_code: 'USD',
                                    value: "<%= room.price %>", // Ensure this value is a number
                                },
                            }],
                        }).then(function(orderID) {
                            return orderID;
                        });
                    },
                    onApprove: function(data, actions) {
                        return actions.order.capture().then(function(details) {
                            // After payment is successful, show the "Book Now" button
                            document.getElementById('book-button').style.display = 'block';
                            document.getElementById('paypal-button-container').style.display = 'none'; // Hide PayPal button

                            console.log('Payment captured:', details);
                        });
                    },
                    onCancel: function(data) {
                        alert('Payment was canceled');
                    },
                }).render('#paypal-button-container');
            }
        } else {
            paypalButtonContainer.style.display = 'none';  // Hide PayPal button
            bookButton.style.display = 'block'; // Show default 'Book Now' button
        }
    }
</script>

</body>
</html>
